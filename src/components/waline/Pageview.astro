---
// https://waline.js.org/en/guide/features/pageview.html#use-alone
import config from '@/site-config'
---

<script
  is:inline
  type='module'
  data-astro-rerun
  define:vars={{ npmCDN: config.npmCDN, walineServer: config.integ.waline.server }}
>
  async function loadPageview() {
    try {
      const pageview = await import(`${npmCDN}/@waline/client@v3/dist/pageview.js`)
      const el = document.querySelector('.waline-pageview-count')
      if (el) {
        pageview.pageviewCount({
          serverURL: walineServer,
          path: window.location.pathname
        })
      }
    } catch (e) {
      console.error('加载Waline访问量失败：', e)
    }
  }

  const abort = await loadPageview()
  // 500毫秒后，如果网络请求尚未完成，则取消此操作
  setTimeout(() => abort(), 500)
</script>
